title: iOS性能优化（一）—— 卡顿优化
tags:
  - iOS高级
  - 性能优化
categories:
  - iOS开发
date: 2017-04-01 01:50:56
---

<Excerpt in index | 首页摘要>
性能优化从哪些方面着手？
什么是CPU，什么是GPU？
列表卡顿的原因可能有哪些？你平时是怎么优化的？
遇到tableView卡顿嘛？会造成卡顿的原因大致有哪些？
<!-- more -->
<The rest of contents | 余下全文>

# CPU和GPU
在屏幕成像的过程中，CPU和GPU起着至关重要的作用。
* `CPU`——（`Central Processing Unit`，中央处理器）主要负责对象的创建和销毁、对象属性的调整、布局计算、文本的计算和排版、图片的格式转换和解码、图像的绘制（`Core Graphics`）。

* `GPU`——（`Graphics Processing Unit`，图形处理器）主要负责纹理的渲染。
APP的显示一般是由`CPU`和`GPU`协同处理的。
`CPU`负责数据的计算，然后将计算好的数据提交给`GPU`，`GPU`会将这些计算好的数据进行`渲染`，`GPU`将渲染好的数据存放在`帧缓存`里面；接着，`视频控制器`会去读取`帧缓存`里面的数据，然后将读取出来的数据完整地显示在`屏幕`上。这样就完成了数据的显示。

*注意：在iOS中是双缓冲机制，有前帧缓存、后帧缓存。* 

# 卡顿产生的原因及优化思路

* 我们看到的手机APP能够完成一些列的动态显示，其实是由`垂直同步信号（VSync）`和`水平同步信号（HSync）`协作完成。`VSync`先发出，随后`HSync`发出，完成整屏画面的显示；紧接着，再次发出一个`VSync`，显示下一帧的画面。

* 一旦发生了一个`VSync`，`GPU`会立马将缓存里面的数据渲染到屏幕上，完成画面显示。如果`GPU`处理的时间过长，导致`VSync`已经发出，而`GPU`还没有处理完，这时只能显示上一帧的`VSync`，而当前帧的`VSync`就丢失了，俗称`掉帧`。那么原先`GPU`处理好的数据只能由下一帧`VSync`来显示，造成界面的卡顿。

* 卡顿优化的思路：**尽可能减少CPU、GPU的资源消耗。**按照60FPS的刷帧率，每隔16ms就会有一次`VSync`信号，我们只要保证在这个时间段内完成数据的计算，那么卡顿就不会发生。

# 卡顿优化 —— CPU


# 卡顿优化 —— GPU


# 离屏渲染


# 卡顿的检测